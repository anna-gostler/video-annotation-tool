(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(7),r=a.n(i),o=(a(14),a(1)),l=a(2),m=a(3),h=a(6),u=a(4),p=a(5),d=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).handleSliderInput=function(e){if("mousedown"===e.type)console.log("slider mousedown"),a.setState({startPosX:e.pageX,dragModeOn:!0});else if("mouseup"===e.type)console.log("slider mouseup"),a.props.setFrameNo(a.props.value),a.setState({offsetX:e.pageX-a.state.startPosX,dragModeOn:!1});else if("mousemove"===e.type&&!0===a.state.dragModeOn){var t=e.pageX,s=t-100;s=Math.max(a.props.min_value,s);var n=Math.ceil(s/a.props.imagewidth*a.props.max_value);n=Math.min(n,a.props.max_tracked),a.setState({offsetX:t-a.state.startPosX,selectedFrameNumber:n}),a.props.setFrameNo(n)}},console.log(a.props),a.state={startPosX:0,offsetX:0,dragModeOn:!1},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){r.a.findDOMNode(this).addEventListener("mousedown",this.handleSliderInput),document.addEventListener("mousemove",this.handleSliderInput),document.addEventListener("mouseup",this.handleSliderInput)}},{key:"render",value:function(){return n.a.createElement("div",{style:{width:this.props.imagewidth,backgroundColor:this.props.colorPalette.LightGray,height:"20px",borderRadius:"0px"},className:"backgroundSlider"},n.a.createElement("div",{style:{width:this.props.max_tracked/this.props.num_imgs*100+"%",backgroundColor:"#A9A9A9",height:"20px",top:"0px",position:"relative"},className:"trackedSlider"}),n.a.createElement("div",{style:{backgroundColor:this.props.colorPalette.RoyalBlue,height:"20px",borderRadius:"0px",position:"relative",top:"-20px",width:this.props.value/this.props.num_imgs*100+"%"},className:"selectedSlider"}),n.a.createElement("div",{id:"Thumb",className:"Thumb",style:{left:(this.props.value-1)*(this.props.imagewidth/this.props.num_imgs),backgroundColor:this.props.colorPalette.LightSalmon},onMouseDown:this.props.handleSliderInput,onMouseUp:this.props.handleSliderInput},n.a.createElement("p",{style:{align:"center",textAlign:"center",verticalAlign:"middle",top:"25px",position:"relative"}},this.props.value)))}}]),t}(n.a.Component),c=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).state={resizeModeOn:!1},a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"resizebox",style:{left:this.props.posx,top:this.props.posy},onMouseDown:this.props.handleResize,onMouseMove:this.props.handleResize,onMouseOut:this.props.handleResize})}}]),t}(n.a.Component),f=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){r.a.findDOMNode(Object(o.a)(a)).addEventListener("mousedown",a.handleMouseDown),r.a.findDOMNode(Object(o.a)(a)).addEventListener("mousemove",a.handleDrag),a.props.isSelected},a.componentWillUnmount=function(){r.a.findDOMNode(Object(o.a)(a)).removeEventListener("mousedown",a.handleMouseDown),document.removeEventListener("mouseup",a.handleMouseUp),document.removeEventListener("mousemove",a.handleMouseUp)},a.handleResize=function(e){if(console.log("handle resize"),a.props.isSelected)if("mousedown"===e.type)a.setState({resizeModeOn:!0}),a.setState({ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"nw-resize"}}),document.addEventListener("mousemove",a.handleResize);else if("mousemove"===e.type){if(document.addEventListener("mouseup",a.handleMouseUp),a.setState({ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"nw-resize"}}),a.setState({possibleResizeModeOn:!0}),a.state.resizeModeOn){a.state.w>=5&&(a.setState({w:Math.max(5,e.pageX-a.state.l-100)}),a.setState({ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.w+"px",cursor:"nw-resize"}})),a.state.h>=5&&(a.setState({h:Math.max(5,e.pageY-a.state.t-100)}),a.setState({ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.h+"px",width:a.state.ElementStyle.width,cursor:"nw-resize"}})),a.props.handleBBoxUpdate(a.state.l,a.state.t,a.state.w,a.state.h,a.props.number)}}else"mouseout"===e.type&&a.setState({possibleResizeModeOn:!1,ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"move"}});else a.setState({possibleResizeModeOn:!1,ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"default"}})},a.handleMouseDown=function(e){a.props.isSelected?!1===a.state.possibleResizeModeOn&&(a.setState({dragModeOn:!0,diffx:e.pageX-a.state.l,diffy:e.pageY-a.state.t}),document.addEventListener("mousemove",a.handleDrag),r.a.findDOMNode(Object(o.a)(a)).removeEventListener("mousedown",a.handleMouseDown),document.addEventListener("mouseup",a.handleMouseUp)):a.setState({possibleResizeModeOn:!1,ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"default"}})},a.handleMouseUp=function(e){a.props.isSelected?(document.removeEventListener("mousemove",a.handleResize),a.setState({ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"move"}}),a.setState({dragModeOn:!1,possibleResizeModeOn:!1,resizeModeOn:!1}),document.removeEventListener("mousemove",a.handleDrag),void 0!==r.a.findDOMNode(Object(o.a)(a))&&r.a.findDOMNode(Object(o.a)(a)).addEventListener("mousedown",a.handleMouseDown),document.removeEventListener("mouseup",a.handleMouseUp)):a.setState({possibleResizeModeOn:!1,ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"default"}})},a.handleDrag=function(e){a.props.isSelected?(a.setState({ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"move"}}),!0===a.state.dragModeOn&&(a.setState({l:e.pageX-a.state.diffx,t:e.pageY-a.state.diffy}),a.setState({ElementStyle:{left:e.pageX-a.state.diffx+"px",top:e.pageY-a.state.diffy+"px",height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"move"}}),a.props.handleBBoxUpdate(a.state.l,a.state.t,a.state.w,a.state.h,a.props.number))):a.setState({possibleResizeModeOn:!1,ElementStyle:{left:a.state.ElementStyle.left,top:a.state.ElementStyle.top,height:a.state.ElementStyle.height,width:a.state.ElementStyle.width,cursor:"default"}})},a.state={ElementStyle:{left:e.l+"px",top:e.t+"px",width:e.w+"px",height:e.h+"px",cursor:"default"},l:e.l,t:e.t,h:e.h,w:e.w,diffx:0,diffy:0,dragModeOn:!1,resizeModeOn:!1,possibleResizeModeOn:!1},a.handleResize=a.handleResize.bind(Object(o.a)(a)),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e;return this.props.isSelected&&(e=n.a.createElement(c,{posx:this.state.w-5+"px",posy:this.state.h-5+"px",handleResize:this.handleResize})),n.a.createElement("div",{className:this.props.classname,style:this.state.ElementStyle},e)}}]),t}(n.a.Component),g=function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return n.a.createElement("p",{className:"speech",style:{width:this.props.width,left:this.props.left,top:this.props.top,lineHeight:this.props.lineHeight,display:this.props.display}},this.props.text)}}]),t}(n.a.Component),y=function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return n.a.createElement("p",{className:"speechflipped",style:{width:this.props.width,left:this.props.left,top:this.props.top,lineHeight:this.props.lineHeight,display:this.props.display}},this.props.text)}}]),t}(n.a.Component),b=function(e){function t(e){return Object(l.a)(this,t),Object(h.a)(this,Object(u.a)(t).call(this,e))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"App"},n.a.createElement(v,null))}}]),t}(s.Component),v=function(e){function t(e){var a;Object(l.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).handleKeyPress=function(e){if(13===e.keyCode){console.log("ENTER");var t=a.state.trackerOutput,s=a.state.frameNumber;if(a.isValidBBox(!1===t[s])&&s<a.state.num_imgs){t[s][0]=t[s-1][0],t[s][1]=t[s-1][1],t[s][2]=t[s-1][2],t[s][3]=t[s-1][3];var n=Number(a.state.frameNumber)+1;console.log("set new frameNumber "+n),a.setState({frameNumber:n,maxFrameNumber:Math.max(n,a.state.maxFrameNumber),trackerOutput:t},(function(){a.setState({imagesrc:a.getFrame()})}))}}else 39===e.keyCode?(console.log("RIGHT"),a.setState({frameNumber:Math.min(a.state.frameNumber+1,a.state.maxFrameNumber)},(function(){a.setState({imagesrc:a.getFrame()})}))):37===e.keyCode&&(console.log("LEFT"),a.setState({frameNumber:Math.max(a.state.frameNumber-1,1)},(function(){a.setState({imagesrc:a.getFrame()})})))};for(var s=[],n=0;n<140;n++)s.push([0,0,0,0]);return s[0][0]=40,s[0][1]=42,s[0][2]=23,s[0][3]=66,a.state={trackerOutput:s,frameNumber:1,maxFrameNumber:1,imagesrc:"pedestrian/00000001.jpg",imagewidth:1,original_imagewidth:1,original_height:1,imagebasepath:"pedestrian/",trackingInProgress:0,l:s[0][0],t:s[0][1],h:s[0][2],w:s[0][3],num_imgs:140,frameNumberStyle:{position:"relative",left:"3px"},colorPalette:{CoralReef:"#FD7C6F",LightSalmon:"#F89D7D",RoyalBlue:"#4760E9",BleuDeFrance:"#3197E9",DarkTurquoise:"#11CDDE",LightGray:"#DEDEDE"}},a.handleBBoxUpdate=a.handleBBoxUpdate.bind(Object(o.a)(a)),a.setFrameNo=a.setFrameNo.bind(Object(o.a)(a)),a.onImgLoad=a.onImgLoad.bind(Object(o.a)(a)),a.closeHint=a.closeHint.bind(Object(o.a)(a)),a}return Object(p.a)(t,e),Object(m.a)(t,[{key:"runTracker",value:function(){var e=this;if(0===this.state.trackingInProgress&&this.state.frameNumber<this.state.num_imgs){this.setState({trackingInProgress:1});var t=this.state.frameNumber-1,a="https://video-annotation-tool.azurewebsites.net/left/"+ +this.state.trackerOutput[t][0]+"/top/"+this.state.trackerOutput[t][1]+"/width/"+this.state.trackerOutput[t][2]+"/height/"+this.state.trackerOutput[t][3]+"/frameno/"+t+"/";console.log("App:  python call "+a),fetch(a).then((function(e){return e.text()})).then((function(t){return e.handleTrackerOutput(t)})),document.activeElement.blur()}}},{key:"render",value:function(){var e=this,t=[],a=this.state.frameNumber-1;t.push(n.a.createElement(f,{l:this.state.trackerOutput[a][0],t:this.state.trackerOutput[a][1],w:this.state.trackerOutput[a][2],h:this.state.trackerOutput[a][3],key:a,number:a,classname:"bbox selected",isSelected:!0,frameNumber:this.state.frameNumber,handleBBoxUpdate:this.handleBBoxUpdate}));var s="none";1===this.state.trackingInProgress&&(s="inline");var i="none";1===this.state.frameNumber&&(i="inline");var r="none";return this.state.maxFrameNumber>1&&(r="inline"),n.a.createElement("div",{id:"FrameArea"},t,n.a.createElement("img",{id:"frame",className:"frame",onLoad:this.onImgLoad,src:this.state.imagesrc,alt:"",draggable:"false"}),n.a.createElement("input",{type:"image",src:"track-icon.svg",alt:"run tracker",id:"btn_runtracker",onClick:function(){return e.runTracker()}}),n.a.createElement("input",{type:"image",style:{display:s},className:"rotating",src:"wait-icon.svg",alt:"run tracker"}),n.a.createElement(d,{max_value:this.state.num_imgs,max_tracked:this.state.maxFrameNumber,min_value:1,value:this.state.frameNumber,setFrameNo:this.setFrameNo,colorPalette:this.state.colorPalette,imagewidth:this.state.imagewidth,num_imgs:this.state.num_imgs}),n.a.createElement(g,{text:"Click to run tracker and get bounding box suggestions.",display:"inline",width:"342px",left:"343px",top:"-110px",lineHeight:"50px"}),n.a.createElement(g,{text:"Mark object with box. Press Enter to see next frame.",display:i,width:"320px",left:"10px",top:"-72px",lineHeight:"50px"}),n.a.createElement(y,{text:"Move slider or press arrows to see marked frames.",onClick:this.closeHint,display:r,width:"320px",left:(this.state.frameNumber-1)*(this.state.imagewidth/this.state.num_imgs)-24,top:"310px",lineHeight:"50px"}))}},{key:"closeHint",value:function(){console.log("close")}},{key:"setFrameNo",value:function(e){var t=this;this.setState({frameNumber:e},(function(){t.setState({imagesrc:t.getFrame()})}))}},{key:"handleTrackerOutput",value:function(e){console.log("handle tracker output"),e=e.split("\r\n");for(var t=this.state.trackerOutput,a=this.state.frameNumber,s=this.state.frameNumber;s<Math.min(this.state.frameNumber+e.length-2,this.state.num_imgs);s++){var n=e[s-this.state.frameNumber+1].split(",");if(""===n[0])break;t[s][0]=n[0],t[s][1]=n[1],t[s][2]=n[2],t[s][3]=n[3],a=s}if(s>0&&a+1<this.state.num_imgs){var i=a+1;t[i][0]=t[i-1][0],t[i][1]=t[i-1][1],t[i][2]=t[i-1][2],t[i][3]=t[i-1][3]}var r=a+1;a+2<=this.state.num_imgs&&(r=a+2),console.log("set frameNumber to "+r),this.setState({trackingInProgress:0,trackerOutput:t,frameNumber:r,maxFrameNumber:r,imagesrc:this.getFrameFromFrameNo(r)}),console.log("set maxFrameNumber "+this.state.maxFrameNumber)}},{key:"getFrame",value:function(){return this.state.imagebasepath+this.pad(this.state.frameNumber,8)+".jpg"}},{key:"getFrameFromFrameNo",value:function(e){return this.state.imagebasepath+this.pad(e,8)+".jpg"}},{key:"pad",value:function(e,t){for(var a=e+"";a.length<t;)a="0"+a;return a}},{key:"onImgLoad",value:function(){this.setState({original_imagewidth:document.getElementById("frame").clientWidth,original_imageheight:document.getElementById("frame").clientHeight,imagewidth:document.getElementById("frame").clientWidth})}},{key:"componentDidMount",value:function(){document.getElementById("frame").ondragstart=function(){return!1},this.setState({imagesrc:this.getFrame()}),document.addEventListener("keydown",this.handleKeyPress)}},{key:"handleBBoxUpdate",value:function(e,t,a,s,n){var i=this.state.trackerOutput;i[n][0]=e,i[n][1]=t,i[n][2]=a,i[n][3]=s,this.setState({trackerOutput:i})}},{key:"isValidBBox",value:function(e){return 0!==e[0]||0!==e[1]||0!==e[2]||0!==e[3]}}]),t}(n.a.Component),E=b;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},9:function(e,t,a){e.exports=a(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.38b30460.chunk.js.map