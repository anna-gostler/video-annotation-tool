{"ast":null,"code":"import _assertThisInitialized from\"C:\\\\Users\\\\anna_\\\\azuretest\\\\annotation-tool\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _classCallCheck from\"C:\\\\Users\\\\anna_\\\\azuretest\\\\annotation-tool\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\anna_\\\\azuretest\\\\annotation-tool\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\anna_\\\\azuretest\\\\annotation-tool\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\anna_\\\\azuretest\\\\annotation-tool\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\anna_\\\\azuretest\\\\annotation-tool\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from'react';import Slider from'./Slider.jsx';import BoundingBox from'./BoundingBox';import SpeechBubble from'./SpeechBubble';import SpeechBubbleFlipped from'./SpeechBubbleFlipped';// color scheme https://www.schemecolor.com/coral-blue.php\nvar App=/*#__PURE__*/function(_Component){_inherits(App,_Component);function App(props){_classCallCheck(this,App);return _possibleConstructorReturn(this,_getPrototypeOf(App).call(this,props));}_createClass(App,[{key:\"render\",value:function render(){return React.createElement(\"div\",{className:\"App\"},React.createElement(FrameArea,null));}}]);return App;}(Component);// area shows the video and is the region where the bounding-box(es)\n// can be moved \nvar FrameArea=/*#__PURE__*/function(_React$Component){_inherits(FrameArea,_React$Component);function FrameArea(props){var _this;_classCallCheck(this,FrameArea);_this=_possibleConstructorReturn(this,_getPrototypeOf(FrameArea).call(this,props));// add empty bbox [0,0,0,0] for every frame\n_this.handleKeyPress=function(event){// if user presses enter -> confirm bounding box selection for current frame\n// -> advance frame number\n// save selection of curr bbox\n// jumpt to frame after curr frame\n// if next bbox exists, change curr and leave next bbox the same\n// if next bbox does not exist, set next bbox to curr\nif(event.keyCode===13){// enter\nconsole.log(\"ENTER\");// if no bbox on this.state.frameNumber + 1 copy over previous bbox\nvar _trackerOutput=_this.state.trackerOutput;var i=_this.state.frameNumber;if(_this.isValidBBox(_trackerOutput[i]===false)&&i<_this.state.num_imgs){_trackerOutput[i][0]=_trackerOutput[i-1][0];_trackerOutput[i][1]=_trackerOutput[i-1][1];_trackerOutput[i][2]=_trackerOutput[i-1][2];_trackerOutput[i][3]=_trackerOutput[i-1][3];var _new_frame_number=Number(_this.state.frameNumber)+1;console.log('set new frameNumber '+_new_frame_number);_this.setState({frameNumber:_new_frame_number,maxFrameNumber:Math.max(_new_frame_number,_this.state.maxFrameNumber),trackerOutput:_trackerOutput},function(){_this.setState({imagesrc:_this.getFrame()});});}}else if(event.keyCode===39){// right arrow\nconsole.log('RIGHT');_this.setState({frameNumber:Math.min(_this.state.frameNumber+1,_this.state.maxFrameNumber)},function(){_this.setState({imagesrc:_this.getFrame()});});}else if(event.keyCode===37){// left arrow\nconsole.log('LEFT');_this.setState({frameNumber:Math.max(_this.state.frameNumber-1,1)},function(){_this.setState({imagesrc:_this.getFrame()});});}};var _trackerOutput2=[];var _num_imgs=140;for(var _i=0;_i<_num_imgs;_i++){_trackerOutput2.push([0,0,0,0]);}_trackerOutput2[0][0]=40;_trackerOutput2[0][1]=42;_trackerOutput2[0][2]=23;_trackerOutput2[0][3]=66;_this.state={trackerOutput:_trackerOutput2,frameNumber:1,//start counting at 1\nmaxFrameNumber:1,// max frame number that has been labelled by tracker or manually\nimagesrc:\"pedestrian/00000001.jpg\",imagewidth:1,original_imagewidth:1,original_height:1,imagebasepath:\"pedestrian/\",trackingInProgress:0,// props for BoundingBox\nl:_trackerOutput2[0][0],t:_trackerOutput2[0][1],h:_trackerOutput2[0][2],w:_trackerOutput2[0][3],num_imgs:_num_imgs,frameNumberStyle:{position:\"relative\",left:\"3px\"},colorPalette:{CoralReef:\"#FD7C6F\",LightSalmon:\"#F89D7D\",RoyalBlue:\"#4760E9\",BleuDeFrance:\"#3197E9\",DarkTurquoise:\"#11CDDE\",LightGray:\"#DEDEDE\"}};_this.handleBBoxUpdate=_this.handleBBoxUpdate.bind(_assertThisInitialized(_this));_this.setFrameNo=_this.setFrameNo.bind(_assertThisInitialized(_this));_this.onImgLoad=_this.onImgLoad.bind(_assertThisInitialized(_this));_this.closeHint=_this.closeHint.bind(_assertThisInitialized(_this));//this.getImageCount()\nreturn _this;}/*\ngetImageCount() {\n\n  var imageExists = true;\n  var frameno = 100;\n  while(imageExists){\n    var img = new Image();\n    img.src = this.getFrameFromFrameNo(frameno)\n\n    // if this failed, so the final image was the previous one\n    img.onerror = function() {  imageExists = false}\n    frameno = frameno + 1;\n  }\n  console.log('num imgs ' + imageExists)\n\n}*/ // https://stackoverflow.com/questions/23450534/how-to-call-a-python-function-from-node-js\n// https://www.freecodecamp.org/news/create-a-react-frontend-a-node-express-backend-and-connect-them-together-c5798926047c/\n// ref: https://stackoverflow.com/questions/51845170/how-to-deploy-a-node-js-app-that-runs-a-python-script-in-azure\n//connect to node.js (code in api folder)\n_createClass(FrameArea,[{key:\"runTracker\",value:function runTracker(){var _this2=this;if(this.state.trackingInProgress===0&&this.state.frameNumber<this.state.num_imgs){this.setState({trackingInProgress:1});var f=this.state.frameNumber-1;var pythonCall=\"../../api/routes/callPython/left/\"//\"http://localhost:9000/callPython/\"\n+this.state.trackerOutput[f][0]+\"/top/\"+this.state.trackerOutput[f][1]+\"/width/\"+this.state.trackerOutput[f][2]+\"/height/\"+this.state.trackerOutput[f][3]+\"/frameno/\"+f+\"/\";console.log('App:  python call '+pythonCall);fetch(pythonCall).then(function(res){return res.text();}).then(function(res){return _this2.handleTrackerOutput(res);});document.activeElement.blur();// remove focus from button after click  => not triggered by pressing enter\n}}},{key:\"render\",value:function render(){var _this3=this;var boundingBoxes=[];// code below prints all selected bboxes\n/*\n    for (var i = 0; i < this.state.trackerOutput.length; i += 1) { // this.state.numChildren\n      \n      //console.log('add? ' + this.state.trackerOutput[i][0] + ' ' + this.state.trackerOutput[i][1]+ ' ' + this.state.trackerOutput[i][2]+ ' ' + this.state.trackerOutput[i][3]) \n      if(this.state.trackerOutput[i][0] !== undefined \n        && this.isValidBBox(this.state.trackerOutput[i])){\n        let _classname = \"bbox\"\n        let _isSelected = false\n        if (i !== this.state.frameNumber-1){\n          //_classname = \"bbox selected\"\n          //_isSelected = true\n          //console.log('selected bbox')\n       \n\n        //console.log('add ' + this.state.trackerOutput[i])\n\n        boundingBoxes.push(<BoundingBox \n          l = {this.state.trackerOutput[i][0]} \n          t = {this.state.trackerOutput[i][1]} \n          w = {this.state.trackerOutput[i][2]} \n          h = {this.state.trackerOutput[i][3]}  \n          key={i} \n          number={i}\n          classname = {_classname}\n          isSelected = {_isSelected}\n          frameNumber = {this.state.frameNumber}\n          handleBBoxUpdate = {this.handleBBoxUpdate} />);\n        }\n      }\n    };*/var _classname=\"bbox selected\";var _isSelected=true;var i=this.state.frameNumber-1;//console.log('valid framenumber? ' + (i))\n// place selected bbox on top\nboundingBoxes.push(React.createElement(BoundingBox,{l:this.state.trackerOutput[i][0],t:this.state.trackerOutput[i][1],w:this.state.trackerOutput[i][2],h:this.state.trackerOutput[i][3],key:i,number:i,classname:_classname,isSelected:_isSelected,frameNumber:this.state.frameNumber,handleBBoxUpdate:this.handleBBoxUpdate}));//note: changed slider from input type=\"range\" min=\"1\" step=\"1\" to Slider\nvar diplayWaitIcon='none';if(this.state.trackingInProgress===1){diplayWaitIcon='inline';}var displaySpeechBubble1='none';if(this.state.frameNumber===1){displaySpeechBubble1='inline';}var displaySpeechBubble2='none';if(this.state.maxFrameNumber>1){displaySpeechBubble2='inline';}return React.createElement(\"div\",{id:\"FrameArea\"},boundingBoxes,React.createElement(\"img\",{id:\"frame\",className:\"frame\",onLoad:this.onImgLoad,src:this.state.imagesrc,alt:\"\",draggable:\"false\"}),React.createElement(\"input\",{type:\"image\",src:\"track-icon.svg\",alt:\"run tracker\",id:\"btn_runtracker\",onClick:function onClick(){return _this3.runTracker();}}),React.createElement(\"input\",{type:\"image\",style:{display:diplayWaitIcon},className:\"rotating\",src:\"wait-icon.svg\",alt:\"run tracker\"}),React.createElement(Slider,{max_value:this.state.num_imgs,max_tracked:this.state.maxFrameNumber,min_value:1,value:this.state.frameNumber,setFrameNo:this.setFrameNo,colorPalette:this.state.colorPalette,imagewidth:this.state.imagewidth,num_imgs:this.state.num_imgs}),React.createElement(SpeechBubble,{text:\"Click to run tracker and get bounding box suggestions.\",display:\"inline\",width:\"342px\",left:\"343px\",top:\"-110px\",lineHeight:\"50px\"}),React.createElement(SpeechBubble,{text:\"Mark object with box. Press Enter to see next frame.\",display:displaySpeechBubble1,width:\"320px\",left:\"10px\",top:\"-72px\",lineHeight:\"50px\"}),React.createElement(SpeechBubbleFlipped,{text:\"Move slider or press arrows to see marked frames.\",onClick:this.closeHint,display:displaySpeechBubble2,width:\"320px\",left:(this.state.frameNumber-1)*(this.state.imagewidth/this.state.num_imgs)-24,top:\"310px\",lineHeight:\"50px\"}));}},{key:\"closeHint\",value:function closeHint(){console.log('close');}},{key:\"setFrameNo\",value:function setFrameNo(frameno){var _this4=this;this.setState({frameNumber:frameno},function(){_this4.setState({imagesrc:_this4.getFrame()});});}},{key:\"handleTrackerOutput\",value:function handleTrackerOutput(res){console.log('handle tracker output');res=res.split('\\r\\n');var _trackerOutput=this.state.trackerOutput;// note: at this point frameNumber is the frame where the tracker run started\n// res starts at frameNumber\nvar last_tracked_box=this.state.frameNumber;for(var i=this.state.frameNumber;i<Math.min(this.state.frameNumber+res.length-2,this.state.num_imgs);i++){//-2 because there is always an empty string at the end\nvar item=res[i-this.state.frameNumber+1].split(',');if(item[0]!==\"\"){_trackerOutput[i][0]=item[0];_trackerOutput[i][1]=item[1];_trackerOutput[i][2]=item[2];_trackerOutput[i][3]=item[3];last_tracked_box=i;}else{break;}}// now that we added all the tracked bounding boxes until failure:\n// add at the same location as the last fail all other bboxes\n// suggest bbox one frame after tracking failure frame\nif(i>0&&last_tracked_box+1<this.state.num_imgs){var _i2=last_tracked_box+1;//TODO remove + 1??\n_trackerOutput[_i2][0]=_trackerOutput[_i2-1][0];_trackerOutput[_i2][1]=_trackerOutput[_i2-1][1];_trackerOutput[_i2][2]=_trackerOutput[_i2-1][2];_trackerOutput[_i2][3]=_trackerOutput[_i2-1][3];}var _new_frame_number=last_tracked_box+1;if(last_tracked_box+2<=this.state.num_imgs){_new_frame_number=last_tracked_box+2;}console.log('set frameNumber to '+_new_frame_number);this.setState({trackingInProgress:0,trackerOutput:_trackerOutput,frameNumber:_new_frame_number,maxFrameNumber:_new_frame_number,imagesrc:this.getFrameFromFrameNo(_new_frame_number)});console.log('set maxFrameNumber '+this.state.maxFrameNumber);}},{key:\"getFrame\",value:function getFrame(){return this.state.imagebasepath+this.pad(this.state.frameNumber,8)+\".jpg\";//number with 8 digits pad with leading zeros\n}},{key:\"getFrameFromFrameNo\",value:function getFrameFromFrameNo(frameno){return this.state.imagebasepath+this.pad(frameno,8)+\".jpg\";//number with 8 digits pad with leading zeros\n}},{key:\"pad\",value:function pad(num,size){var s=num+\"\";while(s.length<size){s=\"0\"+s;}return s;}},{key:\"onImgLoad\",value:function onImgLoad(){this.setState({original_imagewidth:document.getElementById('frame').clientWidth,original_imageheight:document.getElementById('frame').clientHeight,imagewidth:document.getElementById('frame').clientWidth});//this.reportWindowSize();\n}},{key:\"componentDidMount\",value:function componentDidMount(){document.getElementById('frame').ondragstart=function(){return false;};this.setState({imagesrc:this.getFrame()});document.addEventListener(\"keydown\",this.handleKeyPress);//window.addEventListener('resize', this.reportWindowSize);\n}/*\n  reportWindowSize = () => {\n\n    console.log('resize')\n    var body = document.getElementsByTagName('body')[0];\n\n    var o_h = this.state.original_imagewidth;\n    var o_w = this.state.original_imageheight;\n\n    // scale image so that it fits the screen\n    var w = body.clientWidth - 200;\n    var h = body.clientHeight - 200;\n\n    if (o_w != w){\n\n      var scale_factor_w = w / o_w;\n      var new_height = o_h * scale_factor_w;\n\n      console.log('oh' + o_h + 'new height ' + new_height)\n      if (new_height > h) {\n        var scale_factor_h = h / o_h;\n        w = o_w * scale_factor_h;\n      }\n\n      this.setState({\n        imagewidth: w,\n      });\n  }\n\n  }*/},{key:\"handleBBoxUpdate\",value:function handleBBoxUpdate(l,t,w,h,number){var temp_trackerOutput=this.state.trackerOutput;temp_trackerOutput[number][0]=l;temp_trackerOutput[number][1]=t;temp_trackerOutput[number][2]=w;temp_trackerOutput[number][3]=h;this.setState({trackerOutput:temp_trackerOutput});}},{key:\"isValidBBox\",value:function isValidBBox(bbox){return bbox[0]!==0||bbox[1]!==0||bbox[2]!==0||bbox[3]!==0;}}]);return FrameArea;}(React.Component);export default App;","map":{"version":3,"sources":["C:/Users/anna_/azuretest/annotation-tool/src/App.js"],"names":["React","Component","Slider","BoundingBox","SpeechBubble","SpeechBubbleFlipped","App","props","FrameArea","handleKeyPress","event","keyCode","console","log","_trackerOutput","state","trackerOutput","i","frameNumber","isValidBBox","num_imgs","_new_frame_number","Number","setState","maxFrameNumber","Math","max","imagesrc","getFrame","min","_num_imgs","push","imagewidth","original_imagewidth","original_height","imagebasepath","trackingInProgress","l","t","h","w","frameNumberStyle","position","left","colorPalette","CoralReef","LightSalmon","RoyalBlue","BleuDeFrance","DarkTurquoise","LightGray","handleBBoxUpdate","bind","setFrameNo","onImgLoad","closeHint","f","pythonCall","fetch","then","res","text","handleTrackerOutput","document","activeElement","blur","boundingBoxes","_classname","_isSelected","diplayWaitIcon","displaySpeechBubble1","displaySpeechBubble2","runTracker","display","frameno","split","last_tracked_box","length","item","getFrameFromFrameNo","pad","num","size","s","getElementById","clientWidth","original_imageheight","clientHeight","ondragstart","addEventListener","number","temp_trackerOutput","bbox"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport Slider from './Slider.jsx'\nimport BoundingBox from './BoundingBox'\nimport SpeechBubble from './SpeechBubble'\nimport SpeechBubbleFlipped from './SpeechBubbleFlipped'\n\n// color scheme https://www.schemecolor.com/coral-blue.php\nclass App extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <FrameArea>\n        </FrameArea>\n      </div>\n    )\n  }\n}\n\n// area shows the video and is the region where the bounding-box(es)\n// can be moved \nclass FrameArea extends React.Component {\n\n  constructor(props) {\n    super(props);\n\n    // add empty bbox [0,0,0,0] for every frame\n    var _trackerOutput = []\n    var _num_imgs = 140;\n    for (var i = 0; i < _num_imgs; i++) {\n      _trackerOutput.push([0,0,0,0]);\n    }\n\n    _trackerOutput[0][0] = 40;\n    _trackerOutput[0][1] = 42;\n    _trackerOutput[0][2] = 23;\n    _trackerOutput[0][3] = 66;\n\n    this.state = { \n      trackerOutput: _trackerOutput, \n      frameNumber: 1, //start counting at 1\n      maxFrameNumber: 1, // max frame number that has been labelled by tracker or manually\n      imagesrc: \"pedestrian/00000001.jpg\",\n      imagewidth: 1,\n      original_imagewidth: 1,\n      original_height: 1,\n      imagebasepath: \"pedestrian/\",\n      trackingInProgress: 0,\n      // props for BoundingBox\n      l: _trackerOutput[0][0],\n      t: _trackerOutput[0][1],\n      h: _trackerOutput[0][2],\n      w: _trackerOutput[0][3],\n      num_imgs: _num_imgs,\n      frameNumberStyle : {\n        position: \"relative\",\n        left: \"3px\",\n      },\n      colorPalette: {\n        CoralReef: \"#FD7C6F\",\n        LightSalmon: \"#F89D7D\",\n        RoyalBlue: \"#4760E9\",\n        BleuDeFrance: \"#3197E9\", \n        DarkTurquoise: \"#11CDDE\",\n        LightGray: \"#DEDEDE\",\n      },\n    };\n\n    this.handleBBoxUpdate = this.handleBBoxUpdate.bind(this)\n    this.setFrameNo = this.setFrameNo.bind(this)\n    this.onImgLoad = this.onImgLoad.bind(this)    \n    this.closeHint = this.closeHint.bind(this)\n\n    //this.getImageCount()\n  }\n\n/*\ngetImageCount() {\n\n  var imageExists = true;\n  var frameno = 100;\n  while(imageExists){\n    var img = new Image();\n    img.src = this.getFrameFromFrameNo(frameno)\n\n    // if this failed, so the final image was the previous one\n    img.onerror = function() {  imageExists = false}\n    frameno = frameno + 1;\n  }\n  console.log('num imgs ' + imageExists)\n\n}*/\n\n\n  // https://stackoverflow.com/questions/23450534/how-to-call-a-python-function-from-node-js\n  // https://www.freecodecamp.org/news/create-a-react-frontend-a-node-express-backend-and-connect-them-together-c5798926047c/\n  // ref: https://stackoverflow.com/questions/51845170/how-to-deploy-a-node-js-app-that-runs-a-python-script-in-azure\n  //connect to node.js (code in api folder)\n  runTracker() {\n    if (this.state.trackingInProgress === 0 && this.state.frameNumber < this.state.num_imgs) {\n      this.setState({\n        trackingInProgress: 1,\n      });\n\n      let f = this.state.frameNumber - 1  \n      let pythonCall = \"../../api/routes/callPython/left/\"   //\"http://localhost:9000/callPython/\"\n                        + this.state.trackerOutput[f][0] +\"/top/\"\n                        + this.state.trackerOutput[f][1] +\"/width/\"\n                        + this.state.trackerOutput[f][2] +\"/height/\"\n                        + this.state.trackerOutput[f][3] +\"/frameno/\" \n                        + f + \"/\"\n\n\n      console.log('App:  python call ' + pythonCall);\n      fetch(pythonCall) \n        .then(res => res.text())\n        .then(res => this.handleTrackerOutput(res) );      \n\n        document.activeElement.blur(); // remove focus from button after click  => not triggered by pressing enter\n    }\n  }\n\n  \n\n  render(){\n\n    const boundingBoxes = [];\n    \n    // code below prints all selected bboxes\n    /*\n    for (var i = 0; i < this.state.trackerOutput.length; i += 1) { // this.state.numChildren\n      \n      //console.log('add? ' + this.state.trackerOutput[i][0] + ' ' + this.state.trackerOutput[i][1]+ ' ' + this.state.trackerOutput[i][2]+ ' ' + this.state.trackerOutput[i][3]) \n      if(this.state.trackerOutput[i][0] !== undefined \n        && this.isValidBBox(this.state.trackerOutput[i])){\n        let _classname = \"bbox\"\n        let _isSelected = false\n        if (i !== this.state.frameNumber-1){\n          //_classname = \"bbox selected\"\n          //_isSelected = true\n          //console.log('selected bbox')\n       \n\n        //console.log('add ' + this.state.trackerOutput[i])\n\n        boundingBoxes.push(<BoundingBox \n          l = {this.state.trackerOutput[i][0]} \n          t = {this.state.trackerOutput[i][1]} \n          w = {this.state.trackerOutput[i][2]} \n          h = {this.state.trackerOutput[i][3]}  \n          key={i} \n          number={i}\n          classname = {_classname}\n          isSelected = {_isSelected}\n          frameNumber = {this.state.frameNumber}\n          handleBBoxUpdate = {this.handleBBoxUpdate} />);\n        }\n      }\n    };*/\n\n    let _classname = \"bbox selected\"\n    let _isSelected = true\n    var i = this.state.frameNumber-1\n    //console.log('valid framenumber? ' + (i))\n    // place selected bbox on top\n    boundingBoxes.push(<BoundingBox \n      l = {this.state.trackerOutput[i][0]} \n      t = {this.state.trackerOutput[i][1]} \n      w = {this.state.trackerOutput[i][2]} \n      h = {this.state.trackerOutput[i][3]}  \n      key={i} \n      number={i}\n      classname = {_classname}\n      isSelected = {_isSelected}\n      frameNumber = {this.state.frameNumber}\n      handleBBoxUpdate = {this.handleBBoxUpdate} />);\n\n    //note: changed slider from input type=\"range\" min=\"1\" step=\"1\" to Slider\n    var diplayWaitIcon = 'none';\n    if(this.state.trackingInProgress === 1){\n      diplayWaitIcon = 'inline';\n    }\n\n    var displaySpeechBubble1 = 'none';\n    if(this.state.frameNumber === 1){\n      displaySpeechBubble1 = 'inline';\n    }\n\n    var displaySpeechBubble2 = 'none';\n    if(this.state.maxFrameNumber > 1){\n      displaySpeechBubble2 = 'inline';\n    }\n\n    return (\n\n      <div id=\"FrameArea\">\n      {boundingBoxes}\n      <img id = \"frame\" className = \"frame\" onLoad={this.onImgLoad} src={this.state.imagesrc}  alt=\"\" draggable=\"false\"></img>\n      <input type=\"image\" src=\"track-icon.svg\" alt=\"run tracker\" id=\"btn_runtracker\" onClick = {() => this.runTracker()}/>\n      <input type=\"image\" style={{display: diplayWaitIcon}} className=\"rotating\" src=\"wait-icon.svg\" alt=\"run tracker\"/>\n      <Slider max_value={this.state.num_imgs} max_tracked = {this.state.maxFrameNumber}  min_value = {1} value={this.state.frameNumber} setFrameNo = {this.setFrameNo} colorPalette = {this.state.colorPalette} imagewidth = {this.state.imagewidth} num_imgs = {this.state.num_imgs}/>\n      <SpeechBubble text = 'Click to run tracker and get bounding box suggestions.' display = 'inline' width = '342px' left = '343px' top = '-110px' lineHeight = '50px'></SpeechBubble>\n      <SpeechBubble text = 'Mark object with box. Press Enter to see next frame.' display = {displaySpeechBubble1}  width = '320px' left = '10px' top = '-72px' lineHeight = '50px'></SpeechBubble>\n      <SpeechBubbleFlipped text = 'Move slider or press arrows to see marked frames.' onClick = {this.closeHint} display = {displaySpeechBubble2}  width = '320px' left = {(this.state.frameNumber - 1) * (this.state.imagewidth/this.state.num_imgs) - 24} top = '310px' lineHeight = '50px'></SpeechBubbleFlipped>\n\n      </div>\n    )\n  }\n\n\n  closeHint(){\n    console.log('close')\n  }\n\n  setFrameNo(frameno){\n    this.setState({\n      frameNumber: frameno,\n    }, () => {\n      this.setState({\n        imagesrc: this.getFrame(),\n      });\n    });\n  }\n\n\n  handleTrackerOutput(res){\n    console.log('handle tracker output')\n    res = res.split('\\r\\n')\n    var _trackerOutput = this.state.trackerOutput;\n\n    // note: at this point frameNumber is the frame where the tracker run started\n    // res starts at frameNumber\n    var last_tracked_box = this.state.frameNumber;\n    for (var i = this.state.frameNumber; i < Math.min(this.state.frameNumber + res.length - 2, this.state.num_imgs); i++ ){ //-2 because there is always an empty string at the end\n\n      var item = res[i - this.state.frameNumber + 1].split(',');\n      if(item[0] !== \"\"){\n        _trackerOutput[i][0] = item[0]; \n        _trackerOutput[i][1] = item[1]; \n        _trackerOutput[i][2] = item[2]; \n        _trackerOutput[i][3] = item[3]; \n        last_tracked_box = i;\n      }else{\n        break;\n      }\n    }\n\n    // now that we added all the tracked bounding boxes until failure:\n    // add at the same location as the last fail all other bboxes\n\n    // suggest bbox one frame after tracking failure frame\n    if (i > 0 && last_tracked_box + 1 < this.state.num_imgs){\n      let i = last_tracked_box + 1 //TODO remove + 1??\n      _trackerOutput[i][0] = _trackerOutput[i-1][0]; \n      _trackerOutput[i][1] = _trackerOutput[i-1][1]; \n      _trackerOutput[i][2] = _trackerOutput[i-1][2]; \n      _trackerOutput[i][3] = _trackerOutput[i-1][3];\n    }\n\n    var _new_frame_number = last_tracked_box + 1; \n    if (last_tracked_box + 2 <= this.state.num_imgs){\n      _new_frame_number = last_tracked_box + 2;\n    }\n    console.log('set frameNumber to ' + _new_frame_number)\n\n    this.setState({ \n      trackingInProgress: 0,\n      trackerOutput: _trackerOutput,\n      frameNumber: _new_frame_number,\n      maxFrameNumber: _new_frame_number,\n      imagesrc: this.getFrameFromFrameNo(_new_frame_number),\n    } );\n\n    console.log('set maxFrameNumber ' + this.state.maxFrameNumber)\n  }\n\n  getFrame(){\n    return this.state.imagebasepath + this.pad(this.state.frameNumber,8) +\".jpg\"  //number with 8 digits pad with leading zeros\n  }\n\n  getFrameFromFrameNo(frameno){\n    return this.state.imagebasepath + this.pad(frameno,8) +\".jpg\"  //number with 8 digits pad with leading zeros\n  }\n\n  pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\n\n\nonImgLoad(){\n   \n  this.setState({\n    original_imagewidth: document.getElementById('frame').clientWidth,\n    original_imageheight: document.getElementById('frame').clientHeight,\n    imagewidth: document.getElementById('frame').clientWidth,\n  });\n  //this.reportWindowSize();\n\n}\n\n  componentDidMount() {\n    document.getElementById('frame').ondragstart = function() { return false; };\n    this.setState({\n      imagesrc: this.getFrame(),\n    });\n    document.addEventListener(\"keydown\", this.handleKeyPress)\n    //window.addEventListener('resize', this.reportWindowSize);\n  }\n\n  /*\n  reportWindowSize = () => {\n\n    console.log('resize')\n    var body = document.getElementsByTagName('body')[0];\n\n    var o_h = this.state.original_imagewidth;\n    var o_w = this.state.original_imageheight;\n\n    // scale image so that it fits the screen\n    var w = body.clientWidth - 200;\n    var h = body.clientHeight - 200;\n\n    if (o_w != w){\n\n      var scale_factor_w = w / o_w;\n      var new_height = o_h * scale_factor_w;\n\n      console.log('oh' + o_h + 'new height ' + new_height)\n      if (new_height > h) {\n        var scale_factor_h = h / o_h;\n        w = o_w * scale_factor_h;\n      }\n\n      this.setState({\n        imagewidth: w,\n      });\n  }\n\n  }*/\n\n  handleBBoxUpdate(l,t,w,h,number){\n    var temp_trackerOutput = this.state.trackerOutput;\n    temp_trackerOutput[number][0] = l;\n    temp_trackerOutput[number][1] = t;\n    temp_trackerOutput[number][2] = w;\n    temp_trackerOutput[number][3] = h;\n\n    this.setState({\n      trackerOutput: temp_trackerOutput,\n    });\n  }\n\n  isValidBBox(bbox){\n    return bbox[0] !== 0 || bbox[1] !== 0 || bbox[2] !== 0 || bbox[3] !== 0\n  }\n\n  handleKeyPress = (event) => {\n\n    // if user presses enter -> confirm bounding box selection for current frame\n    // -> advance frame number\n    // save selection of curr bbox\n    // jumpt to frame after curr frame\n    // if next bbox exists, change curr and leave next bbox the same\n    // if next bbox does not exist, set next bbox to curr\n\n    if (event.keyCode === 13) {  // enter\n      console.log(\"ENTER\")      \n\n      // if no bbox on this.state.frameNumber + 1 copy over previous bbox\n      var _trackerOutput = this.state.trackerOutput\n      let i = this.state.frameNumber\n\n      if (\n        this.isValidBBox(_trackerOutput[i] === false) &&\n        i < this.state.num_imgs){\n          _trackerOutput[i][0] = _trackerOutput[i-1][0]; \n          _trackerOutput[i][1] = _trackerOutput[i-1][1]; \n          _trackerOutput[i][2] = _trackerOutput[i-1][2]; \n          _trackerOutput[i][3] = _trackerOutput[i-1][3];\n\n        let _new_frame_number = (Number(this.state.frameNumber) + 1)\n        console.log('set new frameNumber ' + _new_frame_number)\n\n        this.setState({\n          frameNumber: _new_frame_number,\n          maxFrameNumber: Math.max(_new_frame_number, this.state.maxFrameNumber), \n          trackerOutput: _trackerOutput,\n        }, () => {\n          this.setState({\n            imagesrc: this.getFrame(),\n          });\n        });\n      }\n    }else if(event.keyCode === 39){ // right arrow\n      console.log('RIGHT')\n      this.setState({\n        frameNumber: Math.min(this.state.frameNumber + 1, this.state.maxFrameNumber),\n      }, () => {\n        this.setState({\n          imagesrc: this.getFrame(),\n        });\n      });\n    }else if(event.keyCode === 37){ // left arrow\n      console.log('LEFT')\n      this.setState({\n        frameNumber: Math.max(this.state.frameNumber - 1, 1),\n      }, () => {\n        this.setState({\n          imagesrc: this.getFrame(),\n        });\n      });\n    }\n\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}